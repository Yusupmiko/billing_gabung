<!-- templates/base.html - FINAL FIXED VERSION -->
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Billing System{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        /* Global Compact Settings */
        * {
            margin: 0;
            padding: 0;
        }
        
        body {
            font-size: 12px;
            line-height: 1.3;
        }
        
        /* Compact Sidebar */
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 180px !important;
            padding: 10px !important;
        }
        
        .sidebar h4 {
            font-size: 1.1rem;
            margin-bottom: 15px !important;
        }
        
        .sidebar .nav-link {
            padding: 6px 10px;
            font-size: 0.85rem;
            border-radius: 4px;
            margin-bottom: 3px;
        }
        
        .sidebar .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .sidebar .small {
            font-size: 0.7rem !important;
            margin-top: 20px !important;
        }
        
        /* Compact Navbar */
        .navbar {
            padding: 6px 12px !important;
            min-height: auto !important;
        }
        
        .navbar-brand {
            font-size: 1rem !important;
            margin-bottom: 0 !important;
        }
        
        .navbar .text-muted {
            font-size: 0.8rem;
        }
        
        /* Content Area */
        .content-wrapper {
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        .container-fluid {
            padding: 8px 12px !important;
        }
        
        /* Alert Messages */
        .alert {
            padding: 8px 12px;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        
        .btn-close {
            padding: 4px;
            font-size: 0.7rem;
        }
        
        /* Cards */
        .card {
            border-radius: 4px;
        }
        
        .card-stat {
            border-left: 3px solid;
            transition: transform 0.2s;
        }
        
        .card-stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        /* Remove excessive spacing */
        h1, h2, h3, h4, h5 {
            margin-bottom: 8px;
        }
        
        p {
            margin-bottom: 6px;
        }
        
        /* ‚≠ê TAMBAHAN: Proteksi untuk input/select */
        .verifikasi-input,
        .verifikasi-select {
            pointer-events: auto !important;
            touch-action: auto !important;
        }
        
    </style>
    
    <!-- ‚≠ê SUPPORT CSS BLOCK untuk halaman tertentu -->
    {% block extra_css %}{% endblock %}
    {% block stylesheets %}{% endblock %}
</head>
<body>
    <div class="d-flex">
  <!-- Compact Sidebar -->
<div class="sidebar text-white">
    <h4><i class="bi bi-lightning-charge-fill"></i> Billing PLN</h4>
    <ul class="nav flex-column">

        {% if session.role == 'UP3' %}
            <!-- Hanya tampil untuk role UP3 -->

  <li class="nav-item">
    <a class="nav-link text-white" href="{{ url_for('kelola_user') }}">
        <i class="bi bi-people"></i> Kelola User
    </a>
</li>

            <li class="nav-item">
                <a class="nav-link text-white" href="{{ url_for('dashboard_up3') }}">
                    <i class="bi bi-graph-up"></i> Dashboard UP3
                </a>
            </li>
   <!-- üîç Tambahan: Dashboard Monitoring -->
    <li class="nav-item">
        <a class="nav-link text-white" href="{{ url_for('monitoring.dashboard_monitoring') }}">

            <i class="bi bi-bar-chart-line"></i> Dashboard Monitoring
        </a>
    </li>

            <li class="nav-item">
                <a class="nav-link text-white" href="{{ url_for('view_audit_log') }}">
                    <i class="bi bi-clock-history"></i> Audit Log
                </a>
            </li>
        {% else %}
            <!-- Tampil untuk role selain UP3 -->
            <li class="nav-item">
                <a class="nav-link text-white" href="{{ url_for('dashboard_ulp') }}">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="{{ url_for('view_billing') }}">
                    <i class="bi bi-table"></i> Data Billing Detail
                </a>
            </li>

            <li class="nav-item">
            <a class="nav-link text-white" href="{{ url_for('monitoring.dashboard_monitoring') }}">

                <i class="bi bi-bar-chart-line"></i> Dashboard Monitoring
            </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="{{ url_for('view_audit_log') }}">
                    <i class="bi bi-clock-history"></i> Audit Log
                </a>
            </li>



        {% endif %}

                <li class="nav-item" style="margin-top: 15px;">
                    <a class="nav-link text-white" href="{{ url_for('logout') }}">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </a>
                </li>
            </ul>

            <div class="small text-white-50">
                User: {{ session.username }}<br>
                ULP: {{ session.unitup or 'N/A' }}
            </div>
        </div>

        <!-- Compact Content -->
        <div class="content-wrapper flex-grow-1">
            <nav class="navbar navbar-light bg-white shadow-sm">
                <div class="container-fluid">
                    <span class="navbar-brand">{% block page_title %}Dashboard{% endblock %}</span>
                    <span class="text-muted">{{ session.nama_ulp }}</span>
                </div>
            </nav>

            <div class="container-fluid">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Main Content -->
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>

    <!-- ‚≠ê SCRIPTS - URUTAN YANG BENAR -->
    
    <!-- 1. jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- 2. Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- ‚≠ê 3. PROTEKSI: Disable jQuery event delegation yang bisa konflik -->
    <script>
        console.log('üîß base.html loaded');
        console.log('üì¶ jQuery version:', typeof jQuery !== 'undefined' ? jQuery.fn.jquery : 'Not loaded');
        console.log('üìç Current page:', window.location.pathname);
        
        if (typeof jQuery !== 'undefined') {
            console.log('‚úÖ Disabling jQuery auto-delegation to prevent conflicts');
            
            // ‚≠ê HANYA nonaktifkan untuk halaman view_billing
            if (window.location.pathname.includes('/view_billing')) {
                console.log('üîí Applying jQuery protection for view_billing');
                jQuery.event.special.click = {
                    setup: function() { return false; }
                };
                jQuery.event.special.change = {
                    setup: function() { return false; }
                };
                jQuery.event.special.input = {
                    setup: function() { return false; }
                };
            } else {
                console.log('‚úÖ jQuery delegation active (normal mode)');
            }
        }
    </script>
    
    <!-- ‚≠ê 4. SUPPORT KEDUA NAMA BLOCK -->
    <!-- Block untuk dashboard_monitoring.html (pakai javascripts) -->
    {% block javascripts %}{% endblock %}
    
    <!-- Block untuk view_billing.html (pakai extra_js) -->
    {% block extra_js %}{% endblock %}
    
    <!-- ‚≠ê 5. Debug helper -->
    <script>
        console.log('‚úÖ All base scripts loaded');
    </script>
</body>
</html>